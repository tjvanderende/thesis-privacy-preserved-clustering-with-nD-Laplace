\begin{algorithm}[H]
  \caption{Algorithm to implement the density remapping of $Z$ to be in the domain of $X$}
  \begin{algorithmic}[1]
    \Require $X, Z, \epsilon$                                \Comment{Requires a truncated nD-Laplace output $Z$}
    \Ensure $Z'$
    \State Filter $Z$ with the data points that were remapped by grid.
    \State Construct a kd-tree from $X$
    \For{$z \in Z$, $x, r \in X$}
    \State Find all points $X_r$ inside radius $r$  around $x$ 
    \State Find all points $B_r$ inside radius $r$ around $z$
    \State $\sigma(x) = []$
    \State $Q_r = X_r \cap B_r$
    \State Count number of points $w_r$ within $Q_r$
    \For{$q \in Q_r$}
    \State Find all points $q$ inside radius $r$ around $q$.
    \State Count number of points $w_q$ within $q$.
    \State Calculate $\sigma(x)$ \Comment Equation \ref{eq:optimal-remapping-formula-1}.
    \State Add $\sigma(x)$ to list
    \EndFor
    \State Calculate $z'$ using $Q_r$ and $\sigma(x)$ \Comment Equation: \ref{eq:optimal-remapping-formula-2}.
    \EndFor
  \end{algorithmic}
  \label{alg:optimal-remapping-laplace}
\end{algorithm}

\begin{itemize}
  \item 1: Receives all the points $z \in Z$ that were originally outside the boundary of $X$ (before remapping).
  \item 2: Constructs a KDTree from the original data $X$, so it can be queried.
  \item 6: Denotes the list of densities for point $x$.
  \item 7: Holds the data-points within the radius $r$ of both $x$ and $z$.
\end{itemize}

