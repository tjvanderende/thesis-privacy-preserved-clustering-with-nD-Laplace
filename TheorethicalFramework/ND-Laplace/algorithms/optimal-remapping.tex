\begin{algorithm}[H]
  \caption{Algorithm to implement the density remapping of $z \in Z$ to be in the domain of $x \in X$}
  \begin{algorithmic}[1]
    \Require $x \in X$
    \Require $z \in Z$
    \Require $epsilon$
    \Ensure $z' \in Z$
    \State $Z' = FindRemappedPoints(Z)$ \Comment Algorithm: \ref{alg:find-outside-domain-laplace}
    \State $tree \gets KDTree(X)$
    \For{$z' \in Z'$}
    \State $r = \Call{FindRadius}{(z')}$ 
    \State $X_r \gets \Call{KDTree::query}{x}$ 
    \State $B_r \gets \Call{KDTree::query}{z'} $
    \State $\sigma(x) = []$
    \State $Q_r = \gets X_r \cap B_r$
    \State $w_x = \Call{Length}{X_r, B_r}$ 
    \For{$q \in Q_r$}
    \State $q \gets \Call{KDTree::query}{q}$
    \State $w_q = \Call{Length}{Q_r}$ \Comment 
    \State $\sigma(w_x) \gets \Call{Remap}{w_x, \epsilon}$ \Comment Equation \ref{eq:optimal-remapping-formula-1}.
    \State $\sigma(x) \gets \Call{Append}{\sigma}$ 
    \EndFor
    \State $z' \gets \Call{Average}{\sigma(x)}$ \Comment Equation: \ref{eq:optimal-remapping-formula-2}.
    \EndFor
  \end{algorithmic}
  \label{alg:optimal-remapping-laplace}
\end{algorithm}

\begin{itemize}
  \item 1: Receives all the points $z \in Z$ that are outside the domain of $X$.
  \item 2: Constructs a KDTree from the original data $X$, so it can be queried.
  \item 3: Receives the original privacy radius $r$ that was used to generate $z$ from $x$.
  \item 5: $X_r$ is the set of points $x \in X$ that are within the radius $r$ of $x$.
  \item 6: $B_r$ is the set of points $z \in Z$ that are within the radius $r$ of $z$.
  \item 9: $w_x$ is the "popularity" of $x$ and $z$, for the number of points is counted within the radius $r$.
  \item 12: $w_q$ is the weight of each point $q \in Q_r$, so $q$ is re-assigned to be the number of points within the radius $r$ of $q$.
\end{itemize}

\newpage
\mycomment{The equation for density remapping \ref{eq:optimal-remapping-formula-1} was created for 2-dimensional data.
However, we aim to use this same approach for 3-dimensional and n-dimensional data.
To do so, we first revisit the \gls{pdf} for 3D-Laplace, which was defined using this Equation: \ref{eq:3d-laplace-pdf}.
Few modifications are necessary, as the normalization factor $A$ is now defined using Equation: \ref{eq:optimal-remapping-formula-1}.
\todo[inline]{Formulate the definition of $A$}
\todo[inline]{Check if this can be extended to nD-Laplace}}
